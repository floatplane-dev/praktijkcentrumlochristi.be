/*
* @file
* @brief    boxplus image transition engine
* @author   Levente Hunyadi
* @version  1.3.1
* @remarks  Copyright (C) 2009-2010 Levente Hunyadi
* @remarks  Licensed under GNU/GPLv3, see http://www.gnu.org/licenses/gpl-3.0.html
* @see      http://hunyadi.info.hu/projects/boxplus
*/
if(typeof(__jQuery__)=="undefined"){var __jQuery__=jQuery}(function(f){var c="boxplus-disabled";var a=Math.max;var d=Math.floor;var b=Math.ceil;f.fn.maxWidth=function(){var g=0;this.each(function(h,i){g=a(g,f(i).safeWidth())});return g};f.fn.maxHeight=function(){var g=0;this.each(function(h,i){g=a(g,f(i).safeHeight())});return g};function e(i,h){var g=parseInt(i.css(h));return isNaN(g)?i[h]():g}f.fn.safeWidth=function(){return e(this,"width")};f.fn.safeHeight=function(){return e(this,"height")};f.fn.boxplusTransition=function(h){var i={navigation:"horizontal",loop:true,contextmenu:true,orientation:"vertical",slices:15,effect:"fade",easing:"swing",duration:500,delay:4000};h=f.extend(i,h);var g=this.filter("ul, ol");g.each(function(){var n=h.navigation=="vertical";var x=h.orientation=="horizontal";var L=h.slices;var k=h.duration;var K=h.delay;var v=0;var D=false;var F=f(this).wrap("<div />").before("<div />").css("visibility","hidden");var t=F.parent().addClass("boxplus-transition-wrapper");var A=f("li",F).find("img:first");var y=F.prev().addClass("boxplus-transition").addClass(c);var G=A.length;var s=A.maxWidth();var C=A.maxHeight();t.add(y).css({width:s,height:C});switch(h.navigation){case"horizontal":case"vertical":var o="boxplus-"+h.navigation;y.addClass(o);function w(N){return'<div class="boxplus-'+N+'" />'}y.prepend(f(w("prev")+w("next")).addClass(o).addClass((n?s:C)<120?"boxplus-small":"boxplus-large"));f(".boxplus-prev",y).click(H);f(".boxplus-next",y).click(p)}if(!h.contextmenu){f(document).bind("contextmenu",function(N){return !y.children().add(y).filter(N.target).size()})}var M=(x?C:s)/L;for(var J=0;J<L;J++){var E=d(J*M);f('<div class="boxplus-transition-bars" />').css({left:x?0:E,top:x?E:0,height:x?M:C,width:x?s:M,visibility:"hidden"}).appendTo(y)}l();y.click(z).removeClass(c);q();if(K>0){K=a(K,k+500);var B=window.setInterval(p,K);y.mouseover(function(){window.clearInterval(B)}).mouseout(function(){B=window.setInterval(p,K)})}function z(){A.eq(v).click()}function q(){return m("first")}function H(){return m("prev")}function p(){return m("next")}function I(){return m("last")}function r(P,N,Q){var O=A.eq(v);P.css({backgroundImage:'url("'+O.attr("src")+'")',backgroundPosition:((s-O.safeWidth())/2-N)+"px "+((C-O.safeHeight())/2-Q)+"px"})}function u(O){var N=O.attr("longdesc");if(N){O.attr("src",N).attr("longdesc","")}}function j(){u(A.eq(v));u(A.eq((v-1)%G));u(A.eq((v+1)%G))}function m(R){var P=f(".boxplus-transition-bars",y);if(D){r(y,0,0);P.clearQueue().stop().css("visibility","hidden")}D=true;switch(R){case"first":v=0;break;case"prev":v=(v-1)%G;break;case"next":v=(v+1)%G;break;case"last":v=G-1;break;default:return}l();j();P.css({opacity:1}).each(function(V){var W=f(this);var X=b(V*M+M)-d(V*M);W.css({height:x?X:C,width:x?s:X});var U=W.position();r(W,U.left,U.top)});function T(){P.css("opacity",0).show();return{opacity:1}}function Q(){P.css(x?"width":"height",0);if(x){return{width:s}}else{return{height:C}}}function N(){P.css(x?"height":"width",0);if(x){return{height:b(M)}}else{return{width:b(M)}}}var S;switch(h.effect){case"fade":S=T();break;case"bars":S=Q();break;case"bars+fade":S=f.extend(Q(),T());break;case"shutter":S=N();break;case"shutter+fade":S=f.extend(N(),T());break}P.css("visibility","visible");var O=function(U){return U};switch(R){case"first":case"prev":O=function(U){return L-1-U};break}P.each(function(W){var U=O(W);var V={duration:500,easing:h.easing};if(U==L-1){f.extend(V,{complete:function(){D=false;r(y,0,0);P.css("visibility","hidden")}})}f(this).delay(U*k/L).animate(S,V)});return false}function l(){if(!h.loop){f(".boxplus-prev",y).toggleClass(c,v<=0);f(".boxplus-next",y).toggleClass(c,v>=G-1)}}});return this}})(__jQuery__);